<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Louhos-team" />
  <title>datavaalit-tutorial</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <style>
  
  @font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 400;
    src: local('Lato Regular'), local('Lato-Regular'), url(fonts/Lato.woff) format('woff');
  }
  @font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 700;
    src: local('Lato Bold'), local('Lato-Bold'), url(fonts/LatoBold.woff) format('woff');
  }
  @font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 900;
    src: local('Lato Black'), local('Lato-Black'), url(fonts/LatoBlack.woff) format('woff');
  }
  @font-face {
    font-family: 'Lato';
    font-style: italic;
    font-weight: 400;
    src: local('Lato Italic'), local('Lato-Italic'), url(fonts/LatoItalic.woff) format('woff');
  }
  
  
  -something { /* Just to escape the effect of html tag above in pandoc*/
  
  }
  
  .title /* Pandoc title header (h1.title) */
      {
      text-align: center;
  	border-width:0px;
  	font-size: 1.5em;
  	margin: 0 0 5px 0;
  	word-spacing: .1em;
  	border-bottom: 0px;
  	text-transform:none;
      }
  
  .author /* Pandoc author(s) header (h2.author) */
      {
      text-align: center;
      font-size: 1.1em;
      line-height: 1.2em;
      border-bottom: 0px;
      }
  
  .date /* Pandoc date header (h3.date) */
      {
  	font-family:  Lato, Arial;
  	text-align: center;
  	font-size: 1.1em;
  	line-height: 1.2em;
      }
  
  
  body {
      margin-left: 240px;
      max-width:750px; 
      border: 0px;
      font-family: Lato, Helvetica, sans-serif;
  }
  
  
  #toc {
      font-size:0.9em;
      height: 100%;
      position: fixed; 
      width: 220px;
      left: 5px;
      padding-top: 20px;
      color: #003333;
      border-right: 1px dashed #C1C1C1;
  }
  
  #toc_header {
      font-size: 1em;
      font-weight: bold;    
      border-bottom: 1px dashed #C1C1C1;
      color: black;
  }
  
  
  
  #TOC li {
      padding: 2px 4px;
      margin-left: 2px;
  }
  
  
  #TOC a {
      color: #003333;
      display: block;
  }
  
  
  #TOC {
      font-size:0.9em;
      height: 100%;
      position: fixed; 
      width: 220px;
      left: 5px;
      padding-top: 20px;
      color: #003333;
      border-right: 1px dashed #C1C1C1;
  }
  
  #TOC_HEADER {
      font-size: 1em;
      font-weight: bold;    
      border-bottom: 1px dashed #C1C1C1;
      color: black;
  }
  
  
  
  #TOC li {
      padding: 2px 4px;
      margin-left: 2px;
  }
  
  
  #TOC a {
      color: #003333;
      display: block;
  }
  
  
  blockquote {
  	padding-left: .5em; 
      border-left: 2px solid #C1C1C1;
  	font-style: italic;
  }
  
  
  pre {	
     margin-top: 0;
     max-width: 95%;
     border: 1px dashed #ccc;
     white-space: pre-wrap;
     font-size:1.0em;
      background: #FFFFFF;
  }
  
  pre code {
     display: block; 
     padding: 0.2em;
     font-size:1.0em;
  }
  
  code.r, code.cpp {
     background-color: #ECEEF0;
  }
  
  
  
  ul {
  	font-size: 100% !important;
  	font-family: Lato, Helvetica, sans-serif;
  }
  li {
  	font-family: Lato, Helvetica, sans-serif;
   	font-size: 1em;
   	line-height: 1.1em;
  }
  
  
  p {
  	font-family: Lato, Helvetica, sans-serif;
  	padding-top: 2px;
  	padding-bottom: 2px;
  	font-size: 1em;
  	line-height: 1.2em;
  }
  ol {
  	list-style: decimal outside;
  	list-style-type: decimal;
  	float: none;
  	margin: .5em 0 .5em 30px;
  	padding: 0;
  }
  ul {
  	margin: .2em 0 .2em 10px;
  	padding: 0;
  }
  UL li, ol li {
  	line-height: 1.1em;
  	padding: 2px;
  }
  a:link {
  	color: #657b83;
     /* text-decoration: none; */
  }
  a:hover {
  	color: #657b83;
  }
  a:visited {
  	color: #657b83;
  }
  a:focus {
  	color: #657b83;
  }
  a:active {
  	color: #657b83;
  }
  
  h1 {
  	font-family:  Lato, Arial;
  	font-size: 1.3em;
  	padding: 2px;
  	line-height: 1.3em;
      font-weight: 400;
  	/*letter-spacing: 0.06em;
  	word-spacing: .1em;*/
      border-bottom: 0.5px solid #657b83;
  	text-transform:uppercase;
      color: #657b83;
  }
  h2 {
  	font-family:  Lato, Arial;
  	font-size: 1.1em;
  	padding: 2px;
  	line-height: 1.1em;
      font-weight: 300;
  	letter-spacing: 0.05em;
  	word-spacing: .1em;
  	border-bottom: 0.5px dashed #657b83;
  /*	text-transform:capitalize;*/
      color: #657b83;
  
  }
  h3 {
  	font-family:  Lato, Arial;
  	font-size: 1.1em;
  	padding: 2px;
  	line-height: 1.1em;
      font-weight: 300;
  	letter-spacing: 0.05em;
  	word-spacing: .1em;
      color: #657b83;
  
  }
  h4 {
  	font-family: Lato;
  	font-size: 1.0em;
  	padding: 2px;
  	line-height: 1.0em;
  	color: #555;
  	font-weight: italic;
      color: #657b83;
  }
  h5 {
  	font-family: Avant Garde;
  	font-size: 1.05em;
  	padding: 2px;
  	line-height: 1.15em;
  	color: #555;
  	font-weight: normal;
      color: #657b83;
  }
  h6 {
  	font-family: Lato;
  	font-size: 1em;
  	padding: 2px;
  	line-height: 1.1em;
  	color: #555;
  	font-weight: normal;
      color: #657b83;
  }
  p.caption, table caption, caption{
      margin-top:0em;
      padding:2px;
      font-weight: 600;
      font-size:1.0em;
      text-align:left;
      color: #657b83;
  }
  
  /* table styles */
  table {
  	border-collapse: collapse;
  	border-spacing: 0;
      line-height: 1.4em;
  	font-size: 0.9em;
  	/*font-family: monospace;*/
  
  }
  .views-table, table {
  	margin-left: 2px;
  	margin-bottom: 10px;
  	/*width: 1300px;*/
  }
  tr {
  	line-height: 1.2em;
  	border-bottom: #9e9e9e thin solid;
  }
  tr:last-child {
  	line-height: 1.2em;
  }
  th {
  	margin: 5px 0 5px 0;
  	padding: 0 5px 0 5px;
  /*	border-right: #9e9e9e thin solid; */
  	text-align: left;
  	border-bottom: #9e9e9e thin solid;
  }
  th:last-child {
  	margin: 5px 0 5px 0;
  	padding: 0 5px 0 5px;
  /*	border-right: #9e9e9e thin solid; */
  	text-align: left;
  }
  th:first-child {
  	margin: 5px 0 5px 0;
  	padding: 0 5px 0 5px;
  /*	border: #9e9e9e thin solid; */
  }
  tbody tr {
  	line-height: 1.2em;
  /*	border-left: #9e9e9e thin solid; */
  }
  tbody tr:nth-child(odd) {
  	line-height: 1.2em;
  	background-color: #F3F5F5;
  }
  td {
  	padding: 0 5px 0 5px;
  /*	border-right: #9e9e9e thin solid; */
  }
  td:last-child {
  	padding: 0 5px 0 5px;
  }
  DL {
  	margin: .3em 0 .3em 0;
  }
  DT {
  	margin: .3em 0 .3em 0;
  }
  DD {
  	line-height: 1.5em;
  	list-style: none;
  	margin: .7em 0 .7em 2em;
  }
  td.active {
  	background-color: transparent!important;
  }
  tr:last-child {
  	border-bottom: #9e9e9e thin solid;
  }
  tr:first-child {
  	border-top: #9e9e9e thin solid;
  }
  th:last-child {
  /*	border-left: #9e9e9e thin solid; */
  }
  th:last-child {
  	/*border-right: #9e9e9e thin solid;*/
  }
  </style>
  
  <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="header">
<h1 class="title">datavaalit-tutorial</h1>
<h2 class="author">Louhos-team</h2>
</div>
<div id="TOC">
<ul>
<li><a href="#kunnallisvaalit-2012">Kunnallisvaalit 2012</a><ul>
<li><a href="#sosiaalisen-median-päivitystiheydet-aikasarjana">Sosiaalisen median päivitystiheydet aikasarjana</a></li>
<li><a href="#aktiivisimmat-statuspäivittäjät">Aktiivisimmat statuspäivittäjät</a></li>
<li><a href="#puolueiden-aktiivisuus-sosiaalisessa-mediassa-absoluuttinen-lukumäärä">Puolueiden aktiivisuus sosiaalisessa mediassa (absoluuttinen lukumäärä)</a></li>
<li><a href="#puolueitten-aktiivisuus-sosiaalisessa-mediassa-edustajaa-kohden">Puolueitten aktiivisuus sosiaalisessa mediassa (edustajaa kohden)</a></li>
<li><a href="#miehet-twiittaa-naiset-facebookkaa">Miehet twiittaa, naiset facebookkaa</a></li>
</ul></li>
</ul>
</div>
<h1 id="kunnallisvaalit-2012">Kunnallisvaalit 2012</h1>
<p>Seuraavat esimerkit visualisoivat R-ympäristössä kunnallisvaaliehdokkaiden aktiivisuutta sosiaalisessa mediassa 2012. Lähde: <a href="https://louhos.wordpress.com/2012/10/26/kunnallisvaaliehdokkaiden-aktiivisuus-sosiaalisessa-mediassa-puolueiden-vertailua/">Louhos-blogi</a>.</p>
<p>Aloitetaan hakemalla CSV-dumppi Datavaalit-palvelimelta ja muuta vaalidataa.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sorvi installation: http://louhos.github.com/sorvi/asennus.html</span>
<span class="kw">library</span>(sorvi)
<span class="kw">library</span>(ggplot2)

<span class="co"># Download and unpack social media aggregate data dump</span>
url &lt;-<span class="st"> &quot;http://www.datavaalit.fi/storage/avoindata/datavaalit-data/some-aggregaatti/some-updates-2013-01-22.csv.bz2&quot;</span>
<span class="kw">download.file</span>(url, <span class="dt">destfile =</span> <span class="st">&quot;some-updates.csv.bz2&quot;</span>)

<span class="co"># Read table and name the columns</span>
tsome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">bzfile</span>(<span class="st">&quot;some-updates.csv.bz2&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">header =</span> <span class="ot">FALSE</span>)
<span class="kw">names</span>(tsome) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;nimi&quot;</span>, <span class="st">&quot;puolue&quot;</span>, <span class="st">&quot;kunta&quot;</span>, <span class="st">&quot;sukupuoli&quot;</span>, <span class="st">&quot;media&quot;</span>, <span class="st">&quot;aika&quot;</span>)

<span class="co"># Pick the 2012 updates</span>
tsome &lt;-<span class="st"> </span>tsome[<span class="kw">grep</span>(<span class="st">&quot;2012&quot;</span>, tsome$aika),]
tsome$media &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;FB&quot;</span>, <span class="st">&quot;Facebook&quot;</span>, tsome$media)
tsome$media &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;TW&quot;</span>, <span class="st">&quot;Twitter&quot;</span>, tsome$media)
tsome$media &lt;-<span class="st"> </span><span class="kw">factor</span>(tsome$media)

<span class="co"># Aktiivisimmat some-puolueet</span>
isot &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">which</span>(<span class="kw">table</span>(tsome$puolue) &gt;<span class="st"> </span><span class="dv">1000</span>))

<span class="co"># Hae 2012 kunnallisvaalien puoluetietoja</span>
<span class="co"># Lähde: (C) Oikeusministeriö:</span>
<span class="co"># http://192.49.229.35/K2012/s/ehd_listat/kokomaa.htm#ladattavat</span>
<span class="co"># Load party information (C) Oikeusministeriö 2012</span>
parties.all &lt;-<span class="st"> </span><span class="kw">ReadAllParties</span>()

<span class="co"># Hae kunnallisvaalien ehdokastiedot Datavaalit-palvelimelta</span>
<span class="co"># Lähde: Datavaalit ja Tilastokeskus</span>
<span class="co"># ks. http://louhos.wordpress.com/2012/10/05/kunnallisvaalien-vertailukelpoiset-ehdokasdatat-csv-taulukkoina-2004-2008-2012/</span>
cand &lt;-<span class="st"> </span><span class="kw">read.csv2</span>(<span class="st">&quot;http://www.datavaalit.fi/storage/avoindata/datavaalit-ehdokas-ja-tulostiedot/2012/municipal_elections_candidates_2012_finland.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">fileEncoding =</span> <span class="st">&quot;iso-8859-1&quot;</span>)
cand.per.party &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">table</span>(cand$Puolue_lyhenne_fi))</code></pre>
<h2 id="sosiaalisen-median-päivitystiheydet-aikasarjana">Sosiaalisen median päivitystiheydet aikasarjana</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">theme_set</span>(<span class="kw">theme_bw</span>(<span class="dv">20</span>))
tsome$aika &lt;-<span class="st"> </span><span class="kw">as.Date</span>(tsome$aika)
tsome &lt;-<span class="st"> </span><span class="kw">subset</span>(tsome, puolue %in%<span class="st"> </span>isot)
tsome$puolue &lt;-<span class="st"> </span><span class="kw">droplevels</span>(tsome$puolue)

pics &lt;-<span class="st"> </span><span class="kw">list</span>()
for (me in <span class="kw">c</span>(<span class="st">&quot;Twitter&quot;</span>, <span class="st">&quot;Facebook&quot;</span>)) {

  tsome.sub &lt;-<span class="st"> </span><span class="kw">subset</span>(tsome, media ==<span class="st"> </span>me)
  p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tsome.sub, <span class="kw">aes</span>(<span class="dt">x =</span> aika))
  p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binaxis =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">binwidth=</span><span class="dv">1</span>, <span class="dt">fill=</span><span class="st">&quot;#3B5998&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;lkm&quot;</span>) +<span class="st"> </span><span class="kw">facet_grid</span>(puolue ~<span class="st"> </span>.) +<span class="st"> </span><span class="kw">ggtitle</span>(me) +<span class="st"> </span><span class="kw">scale_x_date</span>() +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>)
  pics[[me]] &lt;-<span class="st"> </span>p
}
<span class="kw">library</span>(gridExtra)
<span class="kw">grid.arrange</span>(pics[[<span class="dv">1</span>]], pics[[<span class="dv">2</span>]], <span class="dt">nrow =</span> <span class="dv">1</span>)</code></pre>
<p><img src="figure/datavaalit-8.png" title="plot of chunk datavaalit-8" alt="plot of chunk datavaalit-8" style="display: block; margin: auto;" /></p>
<h2 id="aktiivisimmat-statuspäivittäjät">Aktiivisimmat statuspäivittäjät</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">theme_set</span>(<span class="kw">theme_bw</span>(<span class="dv">20</span>))
pics &lt;-<span class="st"> </span><span class="kw">list</span>()

for (me in <span class="kw">c</span>(<span class="st">&quot;Twitter&quot;</span>, <span class="st">&quot;Facebook&quot;</span>)) {
  dfs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">list</span>(<span class="dt">count =</span> <span class="kw">table</span>(<span class="kw">subset</span>(tsome, media ==<span class="st"> </span>me)$nimi)))
  dfs &lt;-<span class="st"> </span>dfs[<span class="kw">rev</span>(<span class="kw">order</span>(dfs$count.Freq)),]
  dfs$ind &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="kw">nrow</span>(dfs)
  n &lt;-<span class="st"> </span><span class="dv">40</span>
  pics[[me]] &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dfs[<span class="dv">1</span>:n,], <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">rev</span>(ind), <span class="dt">y =</span> count.Freq)) +<span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> count.Var1), <span class="dt">size =</span> <span class="dv">5</span>) +<span class="st"> </span><span class="kw">ggtitle</span>(me) +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">1</span>, n)) +<span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">0.6</span>*<span class="kw">min</span>(dfs[<span class="dv">1</span>:n, <span class="st">&quot;count.Freq&quot;</span>]), <span class="fl">1.04</span>*<span class="kw">max</span>(dfs[<span class="dv">1</span>:n, <span class="st">&quot;count.Freq&quot;</span>]) +<span class="st"> </span><span class="dv">20</span>)) +<span class="st"> </span><span class="kw">coord_flip</span>() +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Päivitystiheys&quot;</span>) +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Nimi&quot;</span>)

}

<span class="kw">grid.arrange</span>(pics[[<span class="dv">1</span>]], pics[[<span class="dv">2</span>]], <span class="dt">nrow =</span> <span class="dv">1</span>)</code></pre>
<div class="figure">
<img src="figure/some2.png" alt="plot of chunk some2" /><p class="caption">plot of chunk some2</p>
</div>
<h2 id="puolueiden-aktiivisuus-sosiaalisessa-mediassa-absoluuttinen-lukumäärä">Puolueiden aktiivisuus sosiaalisessa mediassa (absoluuttinen lukumäärä)</h2>
<pre class="sourceCode r"><code class="sourceCode r">
stsome &lt;-<span class="st"> </span><span class="kw">subset</span>(tsome, puolue %in%<span class="st"> </span>isot)
stsome$puolue &lt;-<span class="st"> </span><span class="kw">factor</span>(stsome$puolue, <span class="dt">level =</span> <span class="kw">names</span>(<span class="kw">sort</span>(<span class="kw">table</span>(stsome$puolue))))

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(stsome, <span class="kw">aes</span>(<span class="dt">x =</span> puolue, <span class="dt">fill =</span> media, <span class="dt">group =</span> media)) +<span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;bin&quot;</span>, <span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Statuspäivitykset&quot;</span>, <span class="kw">paste</span>(<span class="kw">sort</span>(tsome$aika)[[<span class="dv">1</span>]], <span class="st">&quot;-&quot;</span>, <span class="kw">rev</span>(<span class="kw">sort</span>(tsome$aika))[[<span class="dv">1</span>]], <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">30</span>), <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">15</span>)) +<span class="st"> </span><span class="kw">coord_flip</span>()

<span class="kw">print</span>(p)</code></pre>
<div class="figure">
<img src="figure/some4.png" alt="plot of chunk some4" /><p class="caption">plot of chunk some4</p>
</div>
<h2 id="puolueitten-aktiivisuus-sosiaalisessa-mediassa-edustajaa-kohden">Puolueitten aktiivisuus sosiaalisessa mediassa (edustajaa kohden)</h2>
<p>Erot puolueiden ehdokasmäärissä on huomiotu laskemalla Facebook-viestien määrä ehdokasta kohden. Visualisointien selkeyttämiseksi poistetaan puolueet, joilla on vain yksi ehdokas.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Laske some-aktiivisuus ehdokasta kohden</span>
<span class="co"># (= normalisoi data puolueiden ehdokasmäärillä)</span>
<span class="kw">library</span>(reshape)
some &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="kw">table</span>(tsome[, <span class="kw">c</span>(<span class="st">&quot;puolue&quot;</span>, <span class="st">&quot;media&quot;</span>)]))

pics &lt;-<span class="st"> </span><span class="kw">list</span>()
for (me in <span class="kw">c</span>(<span class="st">&quot;Twitter&quot;</span>, <span class="st">&quot;Facebook&quot;</span>)) {
  msome &lt;-<span class="st"> </span><span class="kw">subset</span>(some, media ==<span class="st"> </span>me)

  msome$normalized &lt;-<span class="st"> </span>msome$value/cand.per.party[<span class="kw">as.character</span>(msome$puolue)]
  msome$candidates &lt;-<span class="st"> </span>cand.per.party[<span class="kw">as.character</span>(msome$puolue)]

  <span class="co"># Poista yhden ehdokkaan puolueet</span>
  msome &lt;-<span class="st"> </span><span class="kw">subset</span>(msome, candidates &gt;<span class="st"> </span><span class="dv">1</span>)

  <span class="co"># Poista puolueet joilla ei mainittavaa aktiivisuutta</span>
  msome &lt;-<span class="st"> </span><span class="kw">subset</span>(msome, normalized &gt;<span class="st"> </span><span class="dv">1</span>)
  
  <span class="co"># puolueen lyhenne ja koko nimi</span>
  msome$puolue.lyh &lt;-<span class="st"> </span><span class="kw">droplevels</span>(msome$puolue)
  msome$puolue &lt;-<span class="st"> </span>parties.all$Nimi_fi[<span class="kw">match</span>(<span class="kw">as.character</span>(msome$puolue), parties.all$Puolue_lyhenne_fi)]

  <span class="co"># Aseta puolueet suuruusjärjestykseen some-aktiivisuuden nojalla</span>
  msome &lt;-<span class="st"> </span>msome[<span class="kw">rev</span>(<span class="kw">order</span>(msome$normalized)),]
  msome$puolue &lt;-<span class="st"> </span><span class="kw">factor</span>(msome$puolue, <span class="dt">levels =</span> <span class="kw">rev</span>(<span class="kw">as.character</span>(msome$puolue)))

  <span class="co"># Visualisoi some-aktiisuus edustajaa kohden</span>
  <span class="kw">library</span>(ggplot2)
  <span class="kw">theme_set</span>(<span class="kw">theme_bw</span>(<span class="dv">15</span>))
  msome$Paivitykset.edustajaa.kohden &lt;-<span class="st"> </span>msome$normalized
  p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(msome, <span class="kw">aes</span>(<span class="dt">x =</span> puolue, <span class="dt">y =</span> Paivitykset.edustajaa.kohden, <span class="dt">group =</span> media)) +<span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) +<span class="st"> </span><span class="kw">coord_flip</span>() +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(me)) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Päivityksiä edustajaa kohden&quot;</span>)
  pics[[me]] &lt;-<span class="st"> </span>p
}

<span class="kw">grid.arrange</span>(pics[[<span class="dv">1</span>]], pics[[<span class="dv">2</span>]], <span class="dt">nrow =</span> <span class="dv">1</span>)</code></pre>
<div class="figure">
<img src="figure/datavaalit-3.png" alt="plot of chunk datavaalit-3" /><p class="caption">plot of chunk datavaalit-3</p>
</div>
<h2 id="miehet-twiittaa-naiset-facebookkaa">Miehet twiittaa, naiset facebookkaa</h2>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tsome, <span class="kw">aes</span>(<span class="dt">x =</span> media, <span class="dt">fill =</span> sukupuoli, <span class="dt">group =</span> sukupuoli)) +<span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;bin&quot;</span>, <span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">name =</span> <span class="st">&quot;&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;gray&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>)) +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Statuspäivitykset&quot;</span>, <span class="kw">paste</span>(<span class="kw">sort</span>(tsome$aika)[[<span class="dv">1</span>]], <span class="st">&quot;-&quot;</span>, <span class="kw">rev</span>(<span class="kw">sort</span>(tsome$aika))[[<span class="dv">1</span>]], <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">15</span>))

<span class="kw">print</span>(p)</code></pre>
<div class="figure">
<img src="figure/some5.png" alt="plot of chunk some5" /><p class="caption">plot of chunk some5</p>
</div>
</body>
</html>

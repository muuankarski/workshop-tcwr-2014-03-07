<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Markus Kainu" />
  <title>rustfare-tutorial</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <style>
  
  @font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 400;
    src: local('Lato Regular'), local('Lato-Regular'), url(fonts/Lato.woff) format('woff');
  }
  @font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 700;
    src: local('Lato Bold'), local('Lato-Bold'), url(fonts/LatoBold.woff) format('woff');
  }
  @font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 900;
    src: local('Lato Black'), local('Lato-Black'), url(fonts/LatoBlack.woff) format('woff');
  }
  @font-face {
    font-family: 'Lato';
    font-style: italic;
    font-weight: 400;
    src: local('Lato Italic'), local('Lato-Italic'), url(fonts/LatoItalic.woff) format('woff');
  }
  
  
  -something { /* Just to escape the effect of html tag above in pandoc*/
  
  }
  
  .title /* Pandoc title header (h1.title) */
      {
      text-align: center;
  	border-width:0px;
  	font-size: 1.5em;
  	margin: 0 0 5px 0;
  	word-spacing: .1em;
  	border-bottom: 0px;
  	text-transform:none;
      }
  
  .author /* Pandoc author(s) header (h2.author) */
      {
      text-align: center;
      font-size: 1.1em;
      line-height: 1.2em;
      border-bottom: 0px;
      }
  
  .date /* Pandoc date header (h3.date) */
      {
  	font-family:  Lato, Arial;
  	text-align: center;
  	font-size: 1.1em;
  	line-height: 1.2em;
      }
  
  
  body {
      margin-left: 240px;
      max-width:750px; 
      border: 0px;
      font-family: Lato, Helvetica, sans-serif;
  }
  
  
  #toc {
      font-size:0.9em;
      height: 100%;
      position: fixed; 
      width: 220px;
      left: 5px;
      padding-top: 20px;
      color: #003333;
      border-right: 1px dashed #C1C1C1;
  }
  
  #toc_header {
      font-size: 1em;
      font-weight: bold;    
      border-bottom: 1px dashed #C1C1C1;
      color: black;
  }
  
  
  
  #TOC li {
      padding: 2px 4px;
      margin-left: 2px;
  }
  
  
  #TOC a {
      color: #003333;
      display: block;
  }
  
  
  #TOC {
      font-size:0.9em;
      height: 100%;
      position: fixed; 
      width: 220px;
      left: 5px;
      padding-top: 20px;
      color: #003333;
      border-right: 1px dashed #C1C1C1;
  }
  
  #TOC_HEADER {
      font-size: 1em;
      font-weight: bold;    
      border-bottom: 1px dashed #C1C1C1;
      color: black;
  }
  
  
  
  #TOC li {
      padding: 2px 4px;
      margin-left: 2px;
  }
  
  
  #TOC a {
      color: #003333;
      display: block;
  }
  
  
  blockquote {
  	padding-left: .5em; 
      border-left: 2px solid #C1C1C1;
  	font-style: italic;
  }
  
  
  pre {	
     margin-top: 0;
     max-width: 95%;
     border: 1px dashed #ccc;
     white-space: pre-wrap;
     font-size:1.0em;
      background: #FFFFFF;
  }
  
  pre code {
     display: block; 
     padding: 0.2em;
     font-size:1.0em;
  }
  
  code.r, code.cpp {
     background-color: #ECEEF0;
  }
  
  
  
  ul {
  	font-size: 100% !important;
  	font-family: Lato, Helvetica, sans-serif;
  }
  li {
  	font-family: Lato, Helvetica, sans-serif;
   	font-size: 1em;
   	line-height: 1.1em;
  }
  
  
  p {
  	font-family: Lato, Helvetica, sans-serif;
  	padding-top: 2px;
  	padding-bottom: 2px;
  	font-size: 1em;
  	line-height: 1.2em;
  }
  ol {
  	list-style: decimal outside;
  	list-style-type: decimal;
  	float: none;
  	margin: .5em 0 .5em 30px;
  	padding: 0;
  }
  ul {
  	margin: .2em 0 .2em 10px;
  	padding: 0;
  }
  UL li, ol li {
  	line-height: 1.1em;
  	padding: 2px;
  }
  a:link {
  	color: #657b83;
     /* text-decoration: none; */
  }
  a:hover {
  	color: #657b83;
  }
  a:visited {
  	color: #657b83;
  }
  a:focus {
  	color: #657b83;
  }
  a:active {
  	color: #657b83;
  }
  
  h1 {
  	font-family:  Lato, Arial;
  	font-size: 1.3em;
  	padding: 2px;
  	line-height: 1.3em;
      font-weight: 400;
  	/*letter-spacing: 0.06em;
  	word-spacing: .1em;*/
      border-bottom: 0.5px solid #657b83;
  	text-transform:none;
      color: #657b83;
  }
  h2 {
  	font-family:  Lato, Arial;
  	font-size: 1.1em;
  	padding: 2px;
  	line-height: 1.1em;
      font-weight: 300;
  	letter-spacing: 0.05em;
  	word-spacing: .1em;
  	border-bottom: 0.5px dashed #657b83;
  /*	text-transform:capitalize;*/
      color: #657b83;
  
  }
  h3 {
  	font-family:  Lato, Arial;
  	font-size: 1.1em;
  	padding: 2px;
  	line-height: 1.1em;
      font-weight: 300;
  	letter-spacing: 0.05em;
  	word-spacing: .1em;
      color: #657b83;
  
  }
  h4 {
  	font-family: Lato;
  	font-size: 1.0em;
  	padding: 2px;
  	line-height: 1.0em;
  	color: #555;
  	font-weight: italic;
      color: #657b83;
  }
  h5 {
  	font-family: Avant Garde;
  	font-size: 1.05em;
  	padding: 2px;
  	line-height: 1.15em;
  	color: #555;
  	font-weight: normal;
      color: #657b83;
  }
  h6 {
  	font-family: Lato;
  	font-size: 1em;
  	padding: 2px;
  	line-height: 1.1em;
  	color: #555;
  	font-weight: normal;
      color: #657b83;
  }
  p.caption, table caption, caption{
      margin-top:0em;
      padding:2px;
      font-weight: 600;
      font-size:1.0em;
      text-align:left;
      color: #657b83;
  }
  
  /* table styles */
  table {
  	border-collapse: collapse;
  	border-spacing: 0;
      line-height: 1.4em;
  	font-size: 0.9em;
  	/*font-family: monospace;*/
  
  }
  .views-table, table {
  	margin-left: 2px;
  	margin-bottom: 10px;
  	/*width: 1300px;*/
  }
  tr {
  	line-height: 1.2em;
  	border-bottom: #9e9e9e thin solid;
  }
  tr:last-child {
  	line-height: 1.2em;
  }
  th {
  	margin: 5px 0 5px 0;
  	padding: 0 5px 0 5px;
  /*	border-right: #9e9e9e thin solid; */
  	text-align: left;
  	border-bottom: #9e9e9e thin solid;
  }
  th:last-child {
  	margin: 5px 0 5px 0;
  	padding: 0 5px 0 5px;
  /*	border-right: #9e9e9e thin solid; */
  	text-align: left;
  }
  th:first-child {
  	margin: 5px 0 5px 0;
  	padding: 0 5px 0 5px;
  /*	border: #9e9e9e thin solid; */
  }
  tbody tr {
  	line-height: 1.2em;
  /*	border-left: #9e9e9e thin solid; */
  }
  tbody tr:nth-child(odd) {
  	line-height: 1.2em;
  	background-color: #F3F5F5;
  }
  td {
  	padding: 0 5px 0 5px;
  /*	border-right: #9e9e9e thin solid; */
  }
  td:last-child {
  	padding: 0 5px 0 5px;
  }
  DL {
  	margin: .3em 0 .3em 0;
  }
  DT {
  	margin: .3em 0 .3em 0;
  }
  DD {
  	line-height: 1.5em;
  	list-style: none;
  	margin: .7em 0 .7em 2em;
  }
  td.active {
  	background-color: transparent!important;
  }
  tr:last-child {
  	border-bottom: #9e9e9e thin solid;
  }
  tr:first-child {
  	border-top: #9e9e9e thin solid;
  }
  th:last-child {
  /*	border-left: #9e9e9e thin solid; */
  }
  th:last-child {
  	/*border-right: #9e9e9e thin solid;*/
  }
  </style>
  
  <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
  
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
</head>
<body>
<div id="header">
<h1 class="title">rustfare-tutorial</h1>
<h2 class="author">Markus Kainu</h2>
<h3 class="date">March 6, 2014</h3>
</div>
<div id="TOC">
<ul>
<li><a href="#rosstat-regional-statistics">Rosstat regional statistics</a></li>
</ul>
</div>
<h2 id="rosstat-regional-statistics">Rosstat regional statistics</h2>
<p>Function <code>IndicatorRosstat()</code> returns a dataset with available indicators and metadata in Russian and English</p>
<pre class="sourceCode r"><code class="sourceCode r">ind &lt;-<span class="st"> </span><span class="kw">IndicatorRosstat</span>()
ind[<span class="dv">1</span>:<span class="dv">3</span>,<span class="dv">1</span>:<span class="dv">3</span>]</code></pre>
<p><a href="http://www.gks.ru/wps/wcm/connect/rosstat_main/rosstat/ru/statistics/publications/catalog/doc_1138623506156">Rosstat regional statistic</a> includes values of the indicators on three levels:</p>
<ol style="list-style-type: decimal">
<li>federal level</li>
<li>federal district level</li>
<li>regional level</li>
</ol>
<p>To dowload the data you may use <code>GetRosstat()</code>-function that requires two arguments,</p>
<ol style="list-style-type: decimal">
<li><code>indicator</code> (from the listing above),</li>
<li><code>level</code> (federal/federal_district/region)</li>
</ol>
<p>The code below returns a dataset at <strong>federal district level</strong> on <strong>infant mortality</strong> and plots a line graph over time.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rustfare)
dat &lt;-<span class="st"> </span><span class="kw">GetRosstat</span>(<span class="st">&quot;average_percapita_income&quot;</span>, <span class="st">&quot;region&quot;</span>)
<span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> value, <span class="dt">color =</span> region_en)) +<span class="st"> </span><span class="kw">geom_point</span>() +<span class="st"> </span><span class="kw">geom_line</span>() +
<span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">merge</span>(dat, <span class="kw">aggregate</span>(year ~<span class="st"> </span>region_en, dat, max),
<span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;year&quot;</span>,<span class="st">&quot;region_en&quot;</span>)),
<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> value, <span class="dt">label =</span> region_en), <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">vjust =</span> -<span class="dv">1</span>,
<span class="dt">size =</span> <span class="dv">3</span>) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre>
<pre><code>## Warning: Removed 3 rows containing missing values (geom_point).
## Warning: Removed 3 rows containing missing values (geom_path).</code></pre>
<div class="figure">
<img src="figure/rustfare1.png" alt="plot of chunk rustfare1" /><p class="caption">plot of chunk rustfare1</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># cast the data into wide format</span>
<span class="kw">library</span>(reshape2)
dat.w &lt;-<span class="st"> </span><span class="kw">dcast</span>(dat, region_en +<span class="st"> </span>id_shape ~<span class="st"> </span>year, <span class="dt">value.var =</span> <span class="st">&quot;value&quot;</span>)

shape &lt;-<span class="st"> </span><span class="kw">GetRusGADM</span>(<span class="st">&quot;region&quot;</span>)
<span class="kw">library</span>(maptools)
dat.w &lt;-<span class="st"> </span>dat.w[!<span class="kw">is.na</span>(dat.w$id_shape), ]
<span class="kw">row.names</span>(dat.w) &lt;-<span class="st"> </span>dat.w$id_shape
<span class="kw">row.names</span>(shape) &lt;-<span class="st"> </span><span class="kw">as.character</span>(shape$ID_1)
dat.w &lt;-<span class="st"> </span>dat.w[<span class="kw">order</span>(<span class="kw">row.names</span>(dat.w)), ]
shape &lt;-<span class="st"> </span>shape[<span class="kw">order</span>(<span class="kw">row.names</span>(shape)), ]
<span class="co"># from above</span>
difference &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">row.names</span>(shape), <span class="kw">row.names</span>(dat.w))
shape &lt;-<span class="st"> </span>shape[!<span class="kw">row.names</span>(shape) %in%<span class="st"> </span>difference, ]
<span class="co"># </span>
df &lt;-<span class="st"> </span><span class="kw">spCbind</span>(shape, dat.w)

<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(rgeos)
df$id &lt;-<span class="st"> </span><span class="kw">rownames</span>(df@data)
map.points &lt;-<span class="st"> </span><span class="kw">fortify</span>(df, <span class="dt">region =</span> <span class="st">&quot;id&quot;</span>)
map.df &lt;-<span class="st"> </span><span class="kw">merge</span>(map.points, df, <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>)

<span class="kw">library</span>(reshape2)
map.df.l &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="dt">data =</span> map.df, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;long&quot;</span>, <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;group&quot;</span>), 
                 <span class="dt">measure.vars =</span> <span class="kw">c</span>(<span class="st">&quot;X2000&quot;</span>, 
    <span class="st">&quot;X2005&quot;</span>, <span class="st">&quot;X2009&quot;</span>))

map.df.l &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="dt">data =</span> map.df, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;long&quot;</span>, <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;group&quot;</span>), 
                 <span class="dt">measure.vars =</span> <span class="kw">c</span>(<span class="st">&quot;X1995&quot;</span>,<span class="st">&quot;X2000&quot;</span>,<span class="st">&quot;X2001&quot;</span>,
                                  <span class="st">&quot;X2002&quot;</span>,<span class="st">&quot;X2003&quot;</span>,<span class="st">&quot;X2004&quot;</span>,
                                  <span class="st">&quot;X2005&quot;</span>,<span class="st">&quot;X2006&quot;</span>,<span class="st">&quot;X2007&quot;</span>,
                                  <span class="st">&quot;X2008&quot;</span>,<span class="st">&quot;X2009&quot;</span>,<span class="st">&quot;X2010&quot;</span>))
<span class="co"># lets tweak a bit and remove X&#39;s from year values and make it into</span>
<span class="co"># numerical</span>
map.df.l$variable &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(map.df.l$variable, <span class="st">&quot;X&quot;</span>, <span class="st">&quot;&quot;</span>)
map.df.l$variable &lt;-<span class="st"> </span><span class="kw">factor</span>(map.df.l$variable)
map.df.l$variable &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">levels</span>(map.df.l$variable))[map.df.l$variable]

<span class="kw">ggplot</span>(map.df.l, <span class="kw">aes</span>(long,lat,<span class="dt">group=</span>group)) +
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> value)) +
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> map.df.l, <span class="kw">aes</span>(long,lat), 
               <span class="dt">fill=</span><span class="ot">NA</span>, 
               <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>,
               <span class="dt">size=</span><span class="fl">0.1</span>) +<span class="st"> </span><span class="co"># white borders</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">project=</span><span class="st">&quot;orthographic&quot;</span>,
            <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">25</span>,<span class="dv">170</span>),
              <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">45</span>,<span class="dv">70</span>)) +
<span class="st">  </span><span class="kw">facet_wrap</span>(~variable, <span class="dt">ncol=</span><span class="dv">1</span>) +
<span class="st">  </span><span class="kw">theme_minimal</span>()</code></pre>
<div class="figure">
<img src="figure/rustfare3.png" alt="plot of chunk rustfare3" /><p class="caption">plot of chunk rustfare3</p>
</div>
</body>
</html>

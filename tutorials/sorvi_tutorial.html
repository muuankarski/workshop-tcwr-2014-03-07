<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Louhos-team" />
  <title>Sorvi-tutorial</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <style>
  
  @font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 400;
    src: local('Lato Regular'), local('Lato-Regular'), url(fonts/Lato.woff) format('woff');
  }
  @font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 700;
    src: local('Lato Bold'), local('Lato-Bold'), url(fonts/LatoBold.woff) format('woff');
  }
  @font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 900;
    src: local('Lato Black'), local('Lato-Black'), url(fonts/LatoBlack.woff) format('woff');
  }
  @font-face {
    font-family: 'Lato';
    font-style: italic;
    font-weight: 400;
    src: local('Lato Italic'), local('Lato-Italic'), url(fonts/LatoItalic.woff) format('woff');
  }
  
  
  -something { /* Just to escape the effect of html tag above in pandoc*/
  
  }
  
  .title /* Pandoc title header (h1.title) */
      {
      text-align: center;
  	border-width:0px;
  	font-size: 1.5em;
  	margin: 0 0 5px 0;
  	word-spacing: .1em;
  	border-bottom: 0px;
  	text-transform:none;
      }
  
  .author /* Pandoc author(s) header (h2.author) */
      {
      text-align: center;
      font-size: 1.1em;
      line-height: 1.2em;
      border-bottom: 0px;
      }
  
  .date /* Pandoc date header (h3.date) */
      {
  	font-family:  Lato, Arial;
  	text-align: center;
  	font-size: 1.1em;
  	line-height: 1.2em;
      }
  
  
  body {
      margin-left: 240px;
      max-width:750px; 
      border: 0px;
      font-family: Lato, Helvetica, sans-serif;
  }
  
  
  #toc {
      font-size:0.9em;
      height: 100%;
      position: fixed; 
      width: 220px;
      left: 5px;
      padding-top: 20px;
      color: #003333;
      border-right: 1px dashed #C1C1C1;
  }
  
  #toc_header {
      font-size: 1em;
      font-weight: bold;    
      border-bottom: 1px dashed #C1C1C1;
      color: black;
  }
  
  
  
  #TOC li {
      padding: 2px 4px;
      margin-left: 2px;
  }
  
  
  #TOC a {
      color: #003333;
      display: block;
  }
  
  
  #TOC {
      font-size:0.9em;
      height: 100%;
      position: fixed; 
      width: 220px;
      left: 5px;
      padding-top: 20px;
      color: #003333;
      border-right: 1px dashed #C1C1C1;
  }
  
  #TOC_HEADER {
      font-size: 1em;
      font-weight: bold;    
      border-bottom: 1px dashed #C1C1C1;
      color: black;
  }
  
  
  
  #TOC li {
      padding: 2px 4px;
      margin-left: 2px;
  }
  
  
  #TOC a {
      color: #003333;
      display: block;
  }
  
  
  blockquote {
  	padding-left: .5em; 
      border-left: 2px solid #C1C1C1;
  	font-style: italic;
  }
  
  
  pre {	
     margin-top: 0;
     max-width: 95%;
     border: 1px dashed #ccc;
     white-space: pre-wrap;
     font-size:1.0em;
      background: #FFFFFF;
  }
  
  pre code {
     display: block; 
     padding: 0.2em;
     font-size:1.0em;
  }
  
  code.r, code.cpp {
     background-color: #ECEEF0;
  }
  
  
  
  ul {
  	font-size: 100% !important;
  	font-family: Lato, Helvetica, sans-serif;
  }
  li {
  	font-family: Lato, Helvetica, sans-serif;
   	font-size: 1em;
   	line-height: 1.1em;
  }
  
  
  p {
  	font-family: Lato, Helvetica, sans-serif;
  	padding-top: 2px;
  	padding-bottom: 2px;
  	font-size: 1em;
  	line-height: 1.2em;
  }
  ol {
  	list-style: decimal outside;
  	list-style-type: decimal;
  	float: none;
  	margin: .5em 0 .5em 30px;
  	padding: 0;
  }
  ul {
  	margin: .2em 0 .2em 10px;
  	padding: 0;
  }
  UL li, ol li {
  	line-height: 1.1em;
  	padding: 2px;
  }
  a:link {
  	color: #657b83;
     /* text-decoration: none; */
  }
  a:hover {
  	color: #657b83;
  }
  a:visited {
  	color: #657b83;
  }
  a:focus {
  	color: #657b83;
  }
  a:active {
  	color: #657b83;
  }
  
  h1 {
  	font-family:  Lato, Arial;
  	font-size: 1.3em;
  	padding: 2px;
  	line-height: 1.3em;
      font-weight: 400;
  	/*letter-spacing: 0.06em;
  	word-spacing: .1em;*/
      border-bottom: 0.5px solid #657b83;
  	text-transform:uppercase;
      color: #657b83;
  }
  h2 {
  	font-family:  Lato, Arial;
  	font-size: 1.1em;
  	padding: 2px;
  	line-height: 1.1em;
      font-weight: 300;
  	letter-spacing: 0.05em;
  	word-spacing: .1em;
  	border-bottom: 0.5px dashed #657b83;
  /*	text-transform:capitalize;*/
      color: #657b83;
  
  }
  h3 {
  	font-family:  Lato, Arial;
  	font-size: 1.1em;
  	padding: 2px;
  	line-height: 1.1em;
      font-weight: 300;
  	letter-spacing: 0.05em;
  	word-spacing: .1em;
      color: #657b83;
  
  }
  h4 {
  	font-family: Lato;
  	font-size: 1.0em;
  	padding: 2px;
  	line-height: 1.0em;
  	color: #555;
  	font-weight: italic;
      color: #657b83;
  }
  h5 {
  	font-family: Avant Garde;
  	font-size: 1.05em;
  	padding: 2px;
  	line-height: 1.15em;
  	color: #555;
  	font-weight: normal;
      color: #657b83;
  }
  h6 {
  	font-family: Lato;
  	font-size: 1em;
  	padding: 2px;
  	line-height: 1.1em;
  	color: #555;
  	font-weight: normal;
      color: #657b83;
  }
  p.caption, table caption, caption{
      margin-top:0em;
      padding:2px;
      font-weight: 600;
      font-size:1.0em;
      text-align:left;
      color: #657b83;
  }
  
  /* table styles */
  table {
  	border-collapse: collapse;
  	border-spacing: 0;
      line-height: 1.4em;
  	font-size: 0.9em;
  	/*font-family: monospace;*/
  
  }
  .views-table, table {
  	margin-left: 2px;
  	margin-bottom: 10px;
  	/*width: 1300px;*/
  }
  tr {
  	line-height: 1.2em;
  	border-bottom: #9e9e9e thin solid;
  }
  tr:last-child {
  	line-height: 1.2em;
  }
  th {
  	margin: 5px 0 5px 0;
  	padding: 0 5px 0 5px;
  /*	border-right: #9e9e9e thin solid; */
  	text-align: left;
  	border-bottom: #9e9e9e thin solid;
  }
  th:last-child {
  	margin: 5px 0 5px 0;
  	padding: 0 5px 0 5px;
  /*	border-right: #9e9e9e thin solid; */
  	text-align: left;
  }
  th:first-child {
  	margin: 5px 0 5px 0;
  	padding: 0 5px 0 5px;
  /*	border: #9e9e9e thin solid; */
  }
  tbody tr {
  	line-height: 1.2em;
  /*	border-left: #9e9e9e thin solid; */
  }
  tbody tr:nth-child(odd) {
  	line-height: 1.2em;
  	background-color: #F3F5F5;
  }
  td {
  	padding: 0 5px 0 5px;
  /*	border-right: #9e9e9e thin solid; */
  }
  td:last-child {
  	padding: 0 5px 0 5px;
  }
  DL {
  	margin: .3em 0 .3em 0;
  }
  DT {
  	margin: .3em 0 .3em 0;
  }
  DD {
  	line-height: 1.5em;
  	list-style: none;
  	margin: .7em 0 .7em 2em;
  }
  td.active {
  	background-color: transparent!important;
  }
  tr:last-child {
  	border-bottom: #9e9e9e thin solid;
  }
  tr:first-child {
  	border-top: #9e9e9e thin solid;
  }
  th:last-child {
  /*	border-left: #9e9e9e thin solid; */
  }
  th:last-child {
  	/*border-right: #9e9e9e thin solid;*/
  }
  </style>
  
  <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="header">
<h1 class="title">Sorvi-tutorial</h1>
<h2 class="author">Louhos-team</h2>
</div>
<div id="TOC">
<ul>
<li><a href="#finnish-open-government-data-toolkit-for-r">Finnish open government data toolkit for R</a><ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#using-the-package">Using the package</a><ul>
<li><a href="#personal-identification-number-hetu">Personal identification number (HETU)</a></li>
<li><a href="#postal-codes">Postal codes</a></li>
<li><a href="#ip-location">IP Location</a></li>
<li><a href="#municipality-information">Municipality information</a></li>
<li><a href="#retrieve-population-register-data">Retrieve population register data</a></li>
<li><a href="#province-information">Province information</a></li>
<li><a href="#company-subsidies-from-the-finnish-government">Company subsidies from the Finnish government</a></li>
<li><a href="#visualization-routines">Visualization routines</a></li>
</ul></li>
</ul></li>
<li><a href="#väestörekisteritietojen-visualisointi">Väestörekisteritietojen visualisointi</a></li>
</ul>
</div>
<h1 id="finnish-open-government-data-toolkit-for-r">Finnish open government data toolkit for R</h1>
<p>This is an R package for Finnish open government data. New contributions are <a href="http://louhos.github.com/contact.html">welcome!</a>.</p>
<p>This work is part of the <a href="http://ropengov.github.com">rOpenGov</a> project.</p>
<h2 id="installation">Installation</h2>
<p>General users (CRAN release version):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;sorvi&quot;</span>)
<span class="kw">library</span>(sorvi)</code></pre>
<p>Developers (Github development version):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)
<span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">&quot;sorvi&quot;</span>, <span class="st">&quot;ropengov&quot;</span>)
<span class="kw">library</span>(sorvi)</code></pre>
<p>Further installation and development instructions can be found at the project <a href="http://ropengov.github.com/sorvi">home page</a>.</p>
<h2 id="using-the-package">Using the package</h2>
<p>For further usage examples, see <a href="http://louhos.wordpress.com">Louhos-blog</a> and <a href="https://github.com/louhos/sorvi/wiki/Data">Datawiki</a>.</p>
<h3 id="personal-identification-number-hetu">Personal identification number (HETU)</h3>
<p>Extracting information from a Finnish personal identification number:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sorvi)
<span class="kw">hetu</span>(<span class="st">&quot;111111-111C&quot;</span>)</code></pre>
<pre><code>## $hetu
## [1] &quot;111111-111C&quot;
## 
## $gender
## [1] &quot;Male&quot;
## 
## $personal.number
## [1] 111
## 
## $checksum
## [1] &quot;C&quot;
## 
## $date
## [1] &quot;1911-11-11&quot;
## 
## $day
## [1] 11
## 
## $month
## [1] 11
## 
## $year
## [1] 1911
## 
## $century.char
## [1] &quot;-&quot;
## 
## attr(,&quot;class&quot;)
## [1] &quot;hetu&quot;</code></pre>
<p>Validating Finnish personal identification number:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">valid.hetu</span>(<span class="st">&quot;010101-0101&quot;</span>) <span class="co"># TRUE/FALSE</span></code></pre>
<pre><code>## [1] TRUE</code></pre>
<h3 id="postal-codes">Postal codes</h3>
<p>Get Finnish postal codes vs. municipalities table from Wikipedia</p>
<pre class="sourceCode r"><code class="sourceCode r">postal.code.table &lt;-<span class="st"> </span><span class="kw">GetPostalCodeInfo</span>()
<span class="kw">head</span>(postal.code.table)</code></pre>
<pre><code>##   postal.code municipality municipality.ascii
## 1       07230       Askola             Askola
## 2       07500       Askola             Askola
## 3       07510       Askola             Askola
## 4       07530       Askola             Askola
## 5       07580       Askola             Askola
## 6       07590       Askola             Askola</code></pre>
<h3 id="ip-location">IP Location</h3>
<p>Get geographic coordinates for a given IP-address from http://www.datasciencetoolkit.org//ip2coordinates/</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ip_location</span>(<span class="st">&quot;137.224.252.10&quot;</span>)</code></pre>
<pre><code>## Error: could not find function &quot;ip_location&quot;</code></pre>
<h3 id="municipality-information">Municipality information</h3>
<p>Finnish municipality information is available through Population Registry (Vaestorekisterikeskus), Statistics Finland (Tilastokeskus) and Land Survey Finland (Maanmittauslaitos). We provide separate download routine for each data set. The row names are in harmonized format and can be used to match data sets from different sources, as different data sets may carry slightly different versions of certain municipality names. Examples for each case:</p>
<p>Finnish municipality information from Land Survey Finland (<a href="http://www.maanmittauslaitos.fi/aineistot-palvelut/latauspalvelut/avoimien-aineistojen-tiedostopalvelu">Maanmittauslaitos, MML</a>).</p>
<pre class="sourceCode r"><code class="sourceCode r">municipality.info.mml &lt;-<span class="st"> </span><span class="kw">GetMunicipalityInfoMML</span>()</code></pre>
<pre><code>## Error: cannot open the connection</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">municipality.info.mml[<span class="dv">1</span>:<span class="dv">2</span>,]</code></pre>
<pre><code>## Error: object &#39;municipality.info.mml&#39; not found</code></pre>
<p>Get information of Finnish provinces from Statistics Finland (<a href="http://pxweb2.stat.fi/Database/Kuntien%20perustiedot/Kuntien%20perustiedot/Kuntaportaali.px">Tilastokeskus</a>)</p>
<pre class="sourceCode r"><code class="sourceCode r">municipality.info.statfi &lt;-<span class="st"> </span><span class="kw">GetMunicipalityInfoStatFi</span>()
municipality.info.statfi[<span class="dv">1</span>:<span class="dv">2</span>,]</code></pre>
<pre><code>##              Alue Maapinta-ala, km2 1.1.2013 Taajama-aste, % 1.1.2012
## Akaa         Akaa                        293                     86.9
## Alajärvi Alajärvi                       1009                     59.7
##          Väkiluku 31.12.2012 Väkiluvun muutos, % 2011 - 2012
## Akaa                   17134                             0.3
## Alajärvi               10268                            -0.6
##          0-14 -vuotiaiden osuus väestöstä, % 31.12.2012
## Akaa                                               18.7
## Alajärvi                                           18.5
##          15-64 -vuotiaiden osuus väestöstä, % 31.12.2012
## Akaa                                                62.5
## Alajärvi                                            59.5
##          65 vuotta täyttäneiden osuus väestöstä, % 31.12.2012
## Akaa                                                     18.8
## Alajärvi                                                 22.0
##          Ruotsinkielisten osuus väestöstä, % 31.12.2012
## Akaa                                                0.2
## Alajärvi                                            0.1
##          Ulkomaiden kansalaisten osuus väestöstä, % 31.12.2012
## Akaa                                                       1.4
## Alajärvi                                                   1.9
##          Kuntien välinen muuttovoitto/-tappio, henkilöä 2012
## Akaa                                                     -21
## Alajärvi                                                 -94
##          Syntyneiden enemmyys, henkilöä 2012
## Akaa                                      50
## Alajärvi                                 -12
##          Perheiden lukumäärä 31.12.2012
## Akaa                               4782
## Alajärvi                           2779
##          Valtionveronalaiset tulot, euroa/tulonsaaja  2011
## Akaa                                                 25041
## Alajärvi                                             21729
##          Asuntokuntien lukumäärä 31.12.2012
## Akaa                                   7767
## Alajärvi                               4152
##          Vuokra-asunnossa asuvien asuntokuntien osuus, % 31.12.2012
## Akaa                                                           19.7
## Alajärvi                                                       15.9
##          Rivi- ja pientaloissa asuvien asuntokuntien osuus asuntokunnista, % 31.12.2012
## Akaa                                                                               71.9
## Alajärvi                                                                           91.4
##          Kesämökkien lukumäärä 31.12.2012
## Akaa                                  886
## Alajärvi                             1300
##          Vähintään keskiasteen tutkinnon suorittaneiden osuus 15 vuotta täyttäneistä, % 31.12.2011
## Akaa                                                                                          64.9
## Alajärvi                                                                                      59.6
##          Korkea-asteen tutkinnon suorittaneiden osuus 15 vuotta täyttäneistä, % 31.12.2011
## Akaa                                                                                  22.8
## Alajärvi                                                                              19.0
##          Kunnassa olevien työpaikkojen lukumäärä 31.12.2011
## Akaa                                                   5000
## Alajärvi                                               3729
##          Työllisten osuus 18-74-vuotiaista, % 31.12.2011
## Akaa                                                61.5
## Alajärvi                                            54.9
##          Työttömyysaste, % 31.12.2011
## Akaa                             10.9
## Alajärvi                         11.5
##          Kunnassa asuvan työllisen työvoiman määrä 31.12.2011
## Akaa                                                     7243
## Alajärvi                                                 3754
##          Asuinkunnassaan työssäkäyvien osuus työllisestä työvoimasta, % 31.12. 2011
## Akaa                                                                           50.6
## Alajärvi                                                                       78.8
##          Alkutuotannon työpaikkojen osuus, % 31.12.2011
## Akaa                                                4.0
## Alajärvi                                           12.6
##          Jalostuksen työpaikkojen osuus, % 31.12.2011
## Akaa                                             36.1
## Alajärvi                                         28.1
##          Palvelujen työpaikkojen osuus, % 31.12.2011
## Akaa                                            58.3
## Alajärvi                                        57.4
##          Toimialaltaan tuntemattomien työpaikkojen osuus, % 31.12.2011
## Akaa                                                               1.6
## Alajärvi                                                           1.9
##          Taloudellinen huoltosuhde, työvoiman ulkopuolella tai työttömänä olevat yhtä työllistä kohti 31.12.2011
## Akaa                                                                                                        1.36
## Alajärvi                                                                                                    1.75
##          Eläkkeellä olevien osuus väestöstä, % 31.12.2011
## Akaa                                                 24.5
## Alajärvi                                             29.0
##          Yritystoimipaikkojen lukumäärä 2012 Kunta.Tilastokeskus    Kunta
## Akaa                                    1003                Akaa     Akaa
## Alajärvi                                 932            Alajärvi Alajärvi</code></pre>
<p>List the province for each municipality in Finland:</p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Specific municipalities</span>
m2p &lt;-<span class="st"> </span><span class="kw">FindProvince</span>(<span class="kw">c</span>(<span class="st">&quot;Helsinki&quot;</span>, <span class="st">&quot;Tampere&quot;</span>, <span class="st">&quot;Turku&quot;</span>))</code></pre>
<pre><code>## Error: cannot open the connection</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(m2p)</code></pre>
<pre><code>## Error: error in evaluating the argument &#39;x&#39; in selecting a method for function &#39;head&#39;: Error: object &#39;m2p&#39; not found</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># All municipalities</span>
m2p &lt;-<span class="st"> </span><span class="kw">FindProvince</span>(municipality.info.statfi$Kunta)</code></pre>
<pre><code>## Error: cannot open the connection</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Speeding up with predefined municipality info table:</span>
m2p &lt;-<span class="st"> </span><span class="kw">FindProvince</span>(<span class="kw">c</span>(<span class="st">&quot;Helsinki&quot;</span>, <span class="st">&quot;Tampere&quot;</span>, <span class="st">&quot;Turku&quot;</span>), municipality.info.mml)</code></pre>
<pre><code>## Error: object &#39;municipality.info.mml&#39; not found</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(m2p)</code></pre>
<pre><code>## Error: error in evaluating the argument &#39;x&#39; in selecting a method for function &#39;head&#39;: Error: object &#39;m2p&#39; not found</code></pre>
<p>Convert municipality codes and names:</p>
<pre class="sourceCode r"><code class="sourceCode r">municipality_ids &lt;-<span class="st"> </span><span class="kw">ConvertMunicipalityCodes</span>()
<span class="kw">head</span>(municipality_ids)</code></pre>
<pre><code>##    id       name
## 1 890    Utsjoki
## 2 854      Pello
## 3 976  Ylitornio
## 4 845    Tervola
## 5 620   Puolanka
## 6 105 Hyrynsalmi</code></pre>
<p>Translate municipality names Finnish/English:</p>
<pre class="sourceCode r"><code class="sourceCode r">translations &lt;-<span class="st"> </span><span class="kw">LoadData</span>(<span class="st">&quot;translations&quot;</span>)
<span class="kw">head</span>(translations)</code></pre>
<pre><code>##   Ã\u0085land Islands         South Karelia Southern Ostrobothnia 
##          &quot;Ahvenanmaa&quot;      &quot;EtelÃĪ-Karjala&quot;    &quot;EtelÃĪ-Pohjanmaa&quot; 
##      Southern Savonia                Kainuu       Tavastia Proper 
##         &quot;EtelÃĪ-Savo&quot;              &quot;Kainuu&quot;         &quot;Kanta-HÃĪme&quot;</code></pre>
<h3 id="retrieve-population-register-data">Retrieve population register data</h3>
<p>Municipality-level population information from <a href="http://vrk.fi/default.aspx?docid=5127&amp;site=3&amp;id=0">Vaestorekisterikeskus</a>:</p>
<pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">GetPopulationRegister</span>()
<span class="kw">head</span>(df)</code></pre>
<pre><code>##           Koodi     Kunta    Kommun Miehet Naiset Yhteensa
## Akaa        020      Akaa      Akaa   8452   8637    17089
## AlajÃ¤rvi   005  Alajärvi  Alajärvi   5226   5214    10440
## Alavieska   009 Alavieska Alavieska   1420   1350     2770
## Alavus      010    Alavus    Alavus   4619   4634     9253
## Asikkala    016  Asikkala  Asikkala   4217   4291     8508
## Askola      018    Askola    Askola   2489   2427     4916</code></pre>
<h3 id="province-information">Province information</h3>
<p>Get information of Finnish provinces from Wikipedia:</p>
<pre class="sourceCode r"><code class="sourceCode r">tab &lt;-<span class="st"> </span><span class="kw">GetProvinceInfoWikipedia</span>()</code></pre>
<pre><code>## Error: could not find function &quot;GetProvinceInfoWikipedia&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(tab)</code></pre>
<pre><code>## Error: error in evaluating the argument &#39;x&#39; in selecting a method for function &#39;head&#39;: Error: object &#39;tab&#39; not found</code></pre>
<h3 id="company-subsidies-from-the-finnish-government">Company subsidies from the Finnish government</h3>
<p>Finnish broadcasting company YLE published a large data set on Finnish company subsidies (<a href="http://ohjelmat.yle.fi/mot/10_9">(C) MOT 10.9.2012</a> over 15 years. See the site for more information; CC-BY-SA 3.0-license.</p>
<pre class="sourceCode r"><code class="sourceCode r">tuet &lt;-<span class="st"> </span><span class="kw">GetMOTYritystuet</span>()</code></pre>
<pre><code>## Error: could not find function &quot;GetMOTYritystuet&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(tuet)</code></pre>
<pre><code>## Error: error in evaluating the argument &#39;x&#39; in selecting a method for function &#39;head&#39;: Error: object &#39;tuet&#39; not found</code></pre>
<h3 id="visualization-routines">Visualization routines</h3>
<p>Line fit with confidence smoothers:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sorvi);
<span class="kw">data</span>(iris);
p &lt;-<span class="st"> </span><span class="kw">vwReg</span>(Sepal.Length ~<span class="st"> </span>Sepal.Width, iris)</code></pre>
<pre><code>##   |                                                                         |                                                                 |   0%  |                                                                         |=                                                                |   1%  |                                                                         |=                                                                |   2%  |                                                                         |==                                                               |   2%  |                                                                         |==                                                               |   3%  |                                                                         |==                                                               |   4%  |                                                                         |===                                                              |   4%  |                                                                         |===                                                              |   5%  |                                                                         |====                                                             |   6%  |                                                                         |=====                                                            |   7%  |                                                                         |=====                                                            |   8%  |                                                                         |======                                                           |   8%  |                                                                         |======                                                           |   9%  |                                                                         |======                                                           |  10%  |                                                                         |=======                                                          |  10%  |                                                                         |=======                                                          |  11%  |                                                                         |=======                                                          |  12%  |                                                                         |========                                                         |  12%  |                                                                         |========                                                         |  13%  |                                                                         |=========                                                        |  14%  |                                                                         |==========                                                       |  15%  |                                                                         |==========                                                       |  16%  |                                                                         |===========                                                      |  16%  |                                                                         |===========                                                      |  17%  |                                                                         |===========                                                      |  18%  |                                                                         |============                                                     |  18%  |                                                                         |============                                                     |  19%  |                                                                         |=============                                                    |  20%  |                                                                         |==============                                                   |  21%  |                                                                         |==============                                                   |  22%  |                                                                         |===============                                                  |  22%  |                                                                         |===============                                                  |  23%  |                                                                         |===============                                                  |  24%  |                                                                         |================                                                 |  24%  |                                                                         |================                                                 |  25%  |                                                                         |=================                                                |  26%  |                                                                         |==================                                               |  27%  |                                                                         |==================                                               |  28%  |                                                                         |===================                                              |  28%  |                                                                         |===================                                              |  29%  |                                                                         |===================                                              |  30%  |                                                                         |====================                                             |  30%  |                                                                         |====================                                             |  31%  |                                                                         |====================                                             |  32%  |                                                                         |=====================                                            |  32%  |                                                                         |=====================                                            |  33%  |                                                                         |======================                                           |  34%  |                                                                         |=======================                                          |  35%  |                                                                         |=======================                                          |  36%  |                                                                         |========================                                         |  36%  |                                                                         |========================                                         |  37%  |                                                                         |========================                                         |  38%  |                                                                         |=========================                                        |  38%  |                                                                         |=========================                                        |  39%  |                                                                         |==========================                                       |  40%  |                                                                         |===========================                                      |  41%  |                                                                         |===========================                                      |  42%  |                                                                         |============================                                     |  42%  |                                                                         |============================                                     |  43%  |                                                                         |============================                                     |  44%  |                                                                         |=============================                                    |  44%  |                                                                         |=============================                                    |  45%  |                                                                         |==============================                                   |  46%  |                                                                         |===============================                                  |  47%  |                                                                         |===============================                                  |  48%  |                                                                         |================================                                 |  48%  |                                                                         |================================                                 |  49%  |                                                                         |================================                                 |  50%  |                                                                         |=================================                                |  50%  |                                                                         |=================================                                |  51%  |                                                                         |=================================                                |  52%  |                                                                         |==================================                               |  52%  |                                                                         |==================================                               |  53%  |                                                                         |===================================                              |  54%  |                                                                         |====================================                             |  55%  |                                                                         |====================================                             |  56%  |                                                                         |=====================================                            |  56%  |                                                                         |=====================================                            |  57%  |                                                                         |=====================================                            |  58%  |                                                                         |======================================                           |  58%  |                                                                         |======================================                           |  59%  |                                                                         |=======================================                          |  60%  |                                                                         |========================================                         |  61%  |                                                                         |========================================                         |  62%  |                                                                         |=========================================                        |  62%  |                                                                         |=========================================                        |  63%  |                                                                         |=========================================                        |  64%  |                                                                         |==========================================                       |  64%  |                                                                         |==========================================                       |  65%  |                                                                         |===========================================                      |  66%  |                                                                         |============================================                     |  67%  |                                                                         |============================================                     |  68%  |                                                                         |=============================================                    |  68%  |                                                                         |=============================================                    |  69%  |                                                                         |=============================================                    |  70%  |                                                                         |==============================================                   |  70%  |                                                                         |==============================================                   |  71%  |                                                                         |==============================================                   |  72%  |                                                                         |===============================================                  |  72%  |                                                                         |===============================================                  |  73%  |                                                                         |================================================                 |  74%  |                                                                         |=================================================                |  75%  |                                                                         |=================================================                |  76%  |                                                                         |==================================================               |  76%  |                                                                         |==================================================               |  77%  |                                                                         |==================================================               |  78%  |                                                                         |===================================================              |  78%  |                                                                         |===================================================              |  79%  |                                                                         |====================================================             |  80%  |                                                                         |=====================================================            |  81%  |                                                                         |=====================================================            |  82%  |                                                                         |======================================================           |  82%  |                                                                         |======================================================           |  83%  |                                                                         |======================================================           |  84%  |                                                                         |=======================================================          |  84%  |                                                                         |=======================================================          |  85%  |                                                                         |========================================================         |  86%  |                                                                         |=========================================================        |  87%  |                                                                         |=========================================================        |  88%  |                                                                         |==========================================================       |  88%  |                                                                         |==========================================================       |  89%  |                                                                         |==========================================================       |  90%  |                                                                         |===========================================================      |  90%  |                                                                         |===========================================================      |  91%  |                                                                         |===========================================================      |  92%  |                                                                         |============================================================     |  92%  |                                                                         |============================================================     |  93%  |                                                                         |=============================================================    |  94%  |                                                                         |==============================================================   |  95%  |                                                                         |==============================================================   |  96%  |                                                                         |===============================================================  |  96%  |                                                                         |===============================================================  |  97%  |                                                                         |===============================================================  |  98%  |                                                                         |================================================================ |  98%  |                                                                         |================================================================ |  99%  |                                                                         |=================================================================| 100%
## [1] &quot;Build ggplot figure ...&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(p)</code></pre>
<div class="figure">
<img src="figure/regressionline.png" alt="plot of chunk regressionline" /><p class="caption">plot of chunk regressionline</p>
</div>
<p>Plot matrix:</p>
<pre class="sourceCode r"><code class="sourceCode r">mat &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">2</span>));
pm &lt;-<span class="st"> </span><span class="kw">PlotMatrix</span>(mat, <span class="st">&quot;twoway&quot;</span>, <span class="dt">midpoint =</span> <span class="dv">2</span>)</code></pre>
<div class="figure">
<img src="figure/unnamed-chunk-1.png" alt="plot of chunk unnamed-chunk-1" /><p class="caption">plot of chunk unnamed-chunk-1</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Plotting the scale</span>
<span class="co"># sc &lt;- PlotScale(pm$colors, pm$breaks)</span></code></pre>
<h1 id="väestörekisteritietojen-visualisointi">Väestörekisteritietojen visualisointi</h1>
<p>Tämä esimerkki hakee Suomen kuntarajat ja vaestorekisterin asukaslukutiedot kunnittain, ja laskee sekä visualisoi sukupuolten suhteellisen osuuden eri kunnissa Suomen kartalla. Lähde: <a href="https://louhos.wordpress.com/2011/10/09/r-paketti-avoimen-suomi-datan-louhintaan/">Louhos-blogi</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sorvi)

<span class="co"># hae suomen kartta ja kuntarajat gadm-muodossa</span>
<span class="kw">library</span>(gisfi)
gadm &lt;-<span class="st"> </span><span class="kw">GetGADM</span>(<span class="st">&quot;FIN_adm&quot;</span>, <span class="st">&quot;Kunta&quot;</span>)</code></pre>
<pre><code>## [1] &quot;gadm&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># vaestorekisterin asukasluvut kunnittain</span>
vrek &lt;-<span class="st"> </span><span class="kw">GetPopulationRegister</span>()

<span class="co"># Liita vaestorekisterin tiedot karttaobjektiin ja</span>
<span class="co"># aseta nollaan asukasluku kunnissa joiden osalta se ei ole tiedossa</span>
gadm$asukkaita &lt;-<span class="st"> </span><span class="kw">log10</span>(<span class="kw">rowSums</span>(vrek[gadm$Kunta, <span class="kw">c</span>(<span class="st">&quot;Miehet&quot;</span>, <span class="st">&quot;Naiset&quot;</span>)]))
gadm$asukkaita[<span class="kw">is.na</span>(gadm$asukkaita)] &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="co"># Laske myos sukupuolten suhteellinen osuus</span>
gadm$miehet.osuus &lt;-<span class="st"> </span>vrek[gadm$Kunta, <span class="st">&quot;Miehet&quot;</span>]/vrek[gadm$Kunta, <span class="st">&quot;Yhteensa&quot;</span>]
gadm$naiset.osuus &lt;-<span class="st"> </span>vrek[gadm$Kunta, <span class="st">&quot;Naiset&quot;</span>]/vrek[gadm$Kunta, <span class="st">&quot;Yhteensa&quot;</span>]
<span class="co"># Aseta arvoon 50% miesten/naisten osuus</span>
<span class="co"># kunnissa joiden osalta vakiluku ei ole tiedossa</span>
gadm$miehet.osuus[<span class="kw">is.na</span>(gadm$miehet.osuus)] &lt;-<span class="st"> </span><span class="fl">0.5</span>
gadm$naiset.osuus[<span class="kw">is.na</span>(gadm$naiset.osuus)] &lt;-<span class="st"> </span><span class="fl">0.5</span>

<span class="co"># paletin rajapisteet</span>
varname &lt;-<span class="st"> &quot;naiset.osuus&quot;</span>
interval &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">abs</span>(gadm[[varname]] -<span class="st"> </span><span class="fl">0.5</span>))
at &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.5</span> -<span class="st"> </span>interval, <span class="fl">0.5</span> +<span class="st"> </span>interval, <span class="dt">length =</span> <span class="dv">100</span>)

<span class="co"># Piirra Suomen kartta varitettyna naisten suhteellisen osuuden nojalla</span>
q &lt;-<span class="st"> </span><span class="kw">PlotShape</span>(gadm, varname, <span class="dt">type =</span> <span class="st">&quot;twoway&quot;</span>,
      <span class="dt">at =</span> at, <span class="dt">main =</span> <span class="st">&quot;Naiset Suomen kunnissa&quot;</span>)</code></pre>
<div class="figure">
<img src="figure/popreg-2.png" alt="plot of chunk popreg-2" /><p class="caption">plot of chunk popreg-2</p>
</div>
</body>
</html>
